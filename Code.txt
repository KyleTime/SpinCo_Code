function turnLeft () {
    for (let index = 0; index < 6; index++) {
        motocart.move(1)
    }
    motocart.rotate(-90)
    for (let index = 0; index < 7; index++) {
        motocart.move(1)
    }
}
function goStraight () {
    for (let index = 0; index < 8; index++) {
        motocart.move(1)
    }
}

function followGPS()
{
    let gps = motocart.getGpsDirection()
    if(gps == 1)
    {
        turnLeft()
    }
    else if(gps == 2)
    {
        turnRight()
    }
    else if(gps == 3)
    {
        goStraight()
    }
}

function followRight()
{
    if (!(motocart.isSidewalkRight())) {
        motocart.rotate(90)
    } else if (motocart.isSidewalkAhead()) {
        motocart.rotate(-90)
    }
    motocart.move(1)
    /*if (motocart.isAtStop()) {
        state = "checking"
        motocart.pauseAtStopSign()
    }*/
}

function main () {
    while (motocart.batteryLevel() > 0) {
        if (state == "orienting") {
            motocart.rotate(90)
            if (motocart.isSidewalkRight()) {
                state = "follow"
            }
        } else if (state == "follow") {

            if(motocart.isPassengerInCart())
            {
                state = "followDP";
            }
            else
            {
                motocart.findNewPassenger()
                state = "followPK";
            }
        }
        else if(state == "followPK")
        {
            if(motocart.isCartAtDestination())
            {
                motocart.pickUpPassenger()
                state = "follow"
            }
            else if(motocart.isAtStop())
            {
                motocart.pauseAtStopSign()
                followGPS()
            }
            else
            {
                followRight();
            }
        }
        else if(state == "followDP")
        {
            if (motocart.isCartAtDestination()) {
                motocart.dropOffPassenger()
                state = "follow"
            }
            else if(motocart.isAtStop())
            {
                motocart.pauseAtStopSign()
                followGPS()
            }
            else
            {
                followRight();
            }
        }
         else if (state == "checking") {
            if (motocart.canRightTurn()) {
                state = "right turn"
            } else if (motocart.canGoStraight()) {
                state = "straight"
            } else if (motocart.canLeftTurn()) {
                state = "left turn"
            }
        } else if (state == "straight") {
            goStraight()
            state = "follow"
        } else if (state == "left turn") {
            turnLeft()
            state = "follow"
        } else if (state == "right turn") {
            turnRight()
            state = "follow"
        }
    }
    player.say("finished with: " + motocart.batteryLevel() + " battery")
}
player.onChat("bat", function () {
    player.say(motocart.batteryLevel())
})
player.onChat("run", function () {
    main()
})
function turnRight () {
    motocart.move(1)
    motocart.rotate(90)
    motocart.move(1)
}
let state = ""
// states ["orienting", "follow", "followPK", "followDP", "checking", "left turn", "right turn", "straight"]
state = "orienting"
